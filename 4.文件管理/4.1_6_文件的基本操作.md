# 4.1_6_文件的基本操作

## 1.知识总览

![image-20210623211208841](https://tuchuang-01.oss-cn-beijing.aliyuncs.com/img/image-20210623211208841.png)

## 2.创建文件

![image-20210623211228977](https://tuchuang-01.oss-cn-beijing.aliyuncs.com/img/image-20210623211228977.png)

- 创建文件create
  1. 在外存中找到文件所需的空间
  2. 创建该文件对应的目录项

## 3.删除文件

![image-20210623211349206](https://tuchuang-01.oss-cn-beijing.aliyuncs.com/img/image-20210623211349206.png)

- 删除文件delete
  1. 根据文件存放路径找到相应的目录文件，从目录中**找到文件名对应的目录项**
  2. 根据该目录项记录的文件在外存的存放位置、文件大小等信息，**回收文件占用的磁盘块**
  3. 从目录表中**删除文件对应的目录项**

## 4.打开文件

![image-20210623211621659](https://tuchuang-01.oss-cn-beijing.aliyuncs.com/img/image-20210623211621659.png)

- 打开文件open
  1. 根据文件存放路径找到相应的目录文件，从目录中**找到文件名对应的目录项**，并检查该用户是否有指定的操作权限
  2. **将目录项复制到内存中的“打开文件表”中**，并将对应表目的编号返回给用户。之后**用户使用打开文件表的编号来指明要操作的文件**
- 注意**打开文件并没有把文件复制到内存中，仅仅是吧目录项复制到了内存中**
- **打开文件表的编号**其实就是**文件描述符**

![image-20210623212059833](https://tuchuang-01.oss-cn-beijing.aliyuncs.com/img/image-20210623212059833.png)

- 打开文件之后，操作系统会维护一个**系统的打开文件表**，整个系统只有一张；每个进程也会维护一个该进程对应的**打开文件表**
- 操作系统会为每个文件维护一个**打开计数器**

## 5.关闭文件

![image-20210623212301561](https://tuchuang-01.oss-cn-beijing.aliyuncs.com/img/image-20210623212301561.png)

- 关闭文件close
  1. 将进程的打开文件表相应表项删除
  2. 回收分配个该文件的内存空间等资源
  3. 系统打开文件表的打开计数器count减1，若count=0，则删除对应表项

## 6.读文件

![image-20210623212520484](https://tuchuang-01.oss-cn-beijing.aliyuncs.com/img/image-20210623212520484.png)

- 读文件read
  1. 进程提供**文件在打开文件表中的索引号**与**读入多少数据**，指明读入的数据要放在内存的什么位置
  2. 从外存向内存复制数据

## 7.写文件

![image-20210623212751382](https://tuchuang-01.oss-cn-beijing.aliyuncs.com/img/image-20210623212751382.png)

- 写文件write
  1. 进程通过打开文件表中的文件索引号指明文件，指明要写出多少数据，写回外存的数据放在内存的什么位置
  2. 操作系统从用户指定的内存区域将指定大小的数据写回写指针指向的外存

## 8.总结

![image-20210623212955444](https://tuchuang-01.oss-cn-beijing.aliyuncs.com/img/image-20210623212955444.png)

